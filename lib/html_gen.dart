
library html_gen;

import 'package:intl/intl.dart';

import 'css.dart';

class HtmlGenerator {
  StringBuffer buffer = new StringBuffer();  
  bool startOfLine = true;
  List<String> tags = [];
  
  HtmlGenerator() {
    println('<!DOCTYPE html>');
    println();
    println('<!-- generated by papyrus on '
       '${new DateFormat.yMd().format(new DateTime.now())} -->');
    println();
  }
  
  void start([String title]) {
    startTag('html');
    startTag('head');
    
    println('<meta charset="utf-8">');
    println('<meta name="viewport" content="width=device-width, initial-scale=1.0">');
    
    if (title != null) {
      println('<title>${title}</title>');
    }
    
    println('<link href="${css.getCssName()}" rel="stylesheet" media="screen">');

    // head
    endTag();
    
    startTag('body');
  }
  
  void startTag(String tag, [String attributes]) {
    if (attributes != null) {
      println('<${tag} ${attributes}>');
    } else {
      println('<${tag}>');
    }
    
    tags.add(tag);
  }
  
  void tag(String tag, [String content]) {
    if (content != null) {
      println('<$tag>$content</$tag>');      
    } else {
      println('<$tag/>');
    }
  }
  
  void endTag() {
    String tag = tags.removeLast();
    
    println('</${tag}>');
  }
  
  void end() {
    // body
    endTag();
    
    // html
    endTag();
  }
  
  String get indent {
    StringBuffer buf = new StringBuffer();
    for (int i = 0; i < tags.length; i++) {
      buf.write('\t');
    }
    return buf.toString();
  }
  
  String toString() {
    return buffer.toString();
  }
  
  void print(String str) {
    if (startOfLine) {
      buffer.write(indent);
      startOfLine = false;
    }
    
    buffer.write(str);
  }
  
  void println([String str]) {
    if (str == null) {
      print('\n');
    } else {
      print('${str}\n');
    }
    
    startOfLine = true;
  }

}
